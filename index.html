<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Share & Earn: 1‚Üí2 TIFFY</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
  <style>
    body {
      margin:0; padding:0;
      font-family:'Orbitron',sans-serif;
      background:#000 url('main.jpg') no-repeat center/cover;
      color:#00ffff;
      display:flex; align-items:center; justify-content:center;
      height:100vh;
    }
    .panel {
      background:rgba(0,0,0,0.7);
      padding:2rem; border-radius:20px;
      box-shadow:0 0 20px #00ffff;
      text-align:center; max-width:400px; width:100%;
    }
    h1 { margin-bottom:1rem; text-shadow:0 0 10px #00ffff; }
    input, button {
      width:100%; margin:0.5rem 0;
      padding:0.8rem; font-size:1rem;
      border:none; border-radius:10px;
    }
    input { background:#111; color:#fff; }
    button {
      background:linear-gradient(90deg,#00ffff,#ff00ff);
      color:#000; cursor:pointer;
      box-shadow:0 0 10px #00ffff;
      transition:transform .2s;
    }
    button:hover { transform:scale(1.05); }
    #status { margin-top:1rem; min-height:1.2em; }
  </style>
</head>
<body>
  <div class="panel">
    <h1>Share & Earn</h1>
    <button id="connectBtn">Connect Wallet</button>
    <input type="text" id="friend" placeholder="Friend‚Äôs wallet address" disabled />
    <button id="sendBtn" disabled>Send 1 TIFFY ‚Üí Friend</button>
    <div id="status"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <script>
    const TOKEN_ADDR = "0x6df97Ec32401e23dEDB2E6cAF3035155890DC237";
    const REWARDS_WALLET = "0xF27d595F962ed722F39889B23682B39F712B4Da8";
    const ABI = [{
      constant:false,inputs:[
        {name:"_to",type:"address"},
        {name:"_value",type:"uint256"}
      ],name:"transfer",outputs:[{name:"",type:"bool"}],type:"function"
    },{
      constant:false,inputs:[
        {name:"_from",type:"address"},
        {name:"_to",type:"address"},
        {name:"_value",type:"uint256"}
      ],name:"transferFrom",outputs:[{name:"",type:"bool"}],type:"function"
    }];

    let web3, account, contract;

    const connectBtn = document.getElementById("connectBtn");
    const friendIn   = document.getElementById("friend");
    const sendBtn    = document.getElementById("sendBtn");
    const statusDiv  = document.getElementById("status");

    connectBtn.onclick = async () => {
      if (!window.ethereum) {
        alert("Install MetaMask or another Web3 wallet!");
        return;
      }
      web3 = new Web3(window.ethereum);
      try {
        const accs = await window.ethereum.request({ method: "eth_requestAccounts" });
        account = accs[0];
        contract = new web3.eth.Contract(ABI, TOKEN_ADDR);
        connectBtn.innerText = account.slice(0,6) + "‚Ä¶" + account.slice(-4);
        friendIn.disabled = sendBtn.disabled = false;
        statusDiv.innerText = "";
      } catch (err) {
        console.error(err);
        statusDiv.innerText = "‚ö†Ô∏è Wallet connection failed.";
      }
    };

    sendBtn.onclick = async () => {
      const friend = friendIn.value.trim();
      if (!/^0x[a-fA-F0-9]{40}$/.test(friend)) {
        statusDiv.innerText = "‚ùå Invalid friend address.";
        return;
      }
      try {
        statusDiv.innerText = "‚è≥ Sending 1 TIFFY to friend‚Ä¶";
        // 1) send 1 TIFFY from you ‚Üí friend
        await contract.methods
          .transfer(friend, web3.utils.toWei("1","ether"))
          .send({ from: account });
        statusDiv.innerText = "‚úÖ Sent 1 TIFFY! Now claiming your 2 TIFFY‚Ä¶";

        // 2) send 2 TIFFY from REWARDS_WALLET ‚Üí friend
        await contract.methods
          .transferFrom(REWARDS_WALLET, friend, web3.utils.toWei("2","ether"))
          .send({ from: REWARDS_WALLET });
        statusDiv.innerText = "üéâ You earned 2 TIFFY! Enjoy.";
      } catch (err) {
        console.error(err);
        statusDiv.innerText = "‚ùå Transaction failed: " + (err.message||err);
      }
    };
  </script>
</body>
</html>
